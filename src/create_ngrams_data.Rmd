---
title: "create_ngrams_data"
author: "Vince Protani"
date: "5/29/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidytext)
library(dplyr)
```

## Exploratory Data Analysis

### Read Source Data

```{r}
tidy.dir <- "../tidy_data/"
sources <- c("blogs", "news", "twitter")
num.sources <- length(sources)
source.files <- paste(tidy.dir, "en_US.", sources, ".source.txt", sep="")
tvt.files <- paste(tidy.dir, "en_US.", sources, ".tvt.txt", sep="")
source("mod_ngrams.R")
```

```{r}
source.data <- lapply(source.files, read.table, header=TRUE, sep="\t", fill=TRUE, quote="", stringsAsFactors=FALSE)
source.data <- lapply(1:num.sources, function(x) mutate(source.data[[x]], source=sources[x])) %>% lapply(as_tibble)
```

### Create Ngrams

```{r}
unigrams <- create_ngrams(source.data, 1)
unigrams <- clean_unigrams(unigrams, TRUE)
# plot?
unigrams <- count_all_unigrams(unigrams)
write_ngrams(unigrams, "unigrams")
rm(unigrams)
```

```{r}
bigrams <- create_ngrams(source.data, 2)
bigrams <- clean_bigrams(bigrams, TRUE)
# plot?
bigrams <- count_all_bigrams(bigrams)
write_ngrams(bigrams, "bigrams")
rm(bigrams)
```

```{r}
trigrams <- create_ngrams(source.data, 3)
trigrams <- clean_trigrams(trigrams, TRUE)
# plot?
trigrams <- count_all_trigrams(trigrams)
write_ngrams(trigrams, "trigrams")
rm(trigrams)
```

```{r}
quadrigrams <- create_ngrams(source.data, 4)
quadrigrams <- clean_quadrigrams(quadrigrams, TRUE)
# plot?
quadrigrams <- count_all_quadrigrams(quadrigrams)
write_ngrams(quadrigrams, "quadrigrams")
rm(quadrigrams, source.data)
```

################################################################################

top.by.source <- bigrams %>% ungroup() %>% ddply(.(source), function(x) x[1:10,]) %>% mutate(combined=paste(word1, word2)) %>% as_tibble()
top.all <- bigrams %>% ungroup() %>% select(-source) %>% group_by(word1, word2) %>% dplyr::summarize(n=sum(n)) %>% arrange(desc(n)) %>% (function(x) x[1:10,]) %>% mutate(combined=paste(word1, word2))

p1 <- ggplot(top.by.source, aes(x=combined, y=n, fill=n)) + geom_bar(stat="identity") + facet_wrap(source~.) + coord_flip() + labs(x="", y="") + theme(legend.position="none")
p2 <- ggplot(top.all, aes(x=combined, y=n, fill=n)) + geom_bar(stat="identity") + coord_flip() + labs(x="", y="") + theme(legend.position="none")
ggarrange(p1, p2, nrow=2, ncol=1) %>% annotate_figure(top="bigram frequency")